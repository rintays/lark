# lark-cli 问题清单（持续更新｜2026-02-04）

> 范围：基于本机环境（Feishu / Agent Space）做真实链路体验测试得到的问题。
> 目标：先列出问题（含复现方式/现象/影响/建议），再逐个修复并回归。

## P0（阻塞/核心功能不可用）

### P0-1 docs export 导出任务失败（job_status=2）
- 复现：
  - `lark docs export <docx_token> --format pdf --out /tmp/x.pdf`
- 现象：
  - `export task failed (job_status=2 job_error_msg="" file_name="" type="" file_extension="")`
- 影响：导出功能不可用（但已排除参数校验层面的 99992402）。
- 初步判断：导出任务本身在服务端失败；需要进一步获取更完整的失败原因（可能需要额外字段/权限/服务端限制/文件类型限制）。
- 建议动作：
  1) 在 verbose 下打印 GetExportTask 的完整 result（已增强部分字段，但仍缺更深线索）。
  2) 如必要，提供“导出任务状态=2”常见原因提示与建议（不做 token-type fallback）。

## P1（功能可用但体验差/容易踩坑/文档不一致）

### P1-1 meetings info 需要 user token + 额外 scope（此前 tenant token 下表现为 data not exist）
- 复现：
  - `lark meetings list --limit 1` 得到 meeting_id
  - `lark meetings info <meeting_id>`
- 现象：
  - 以前使用 tenant token 时经常表现为：`get meeting failed: data not exist`
  - 现在（已修复）：`meetings info` 强制使用 user token，并在缺授权时给出可执行提示：
    - `Missing user OAuth scopes: vc:meeting:readonly, vc:meeting.meetingevent:read`（会补齐 offline_access 并给出 re-login 命令）
- 影响：list→info 的链路不再“假报 data not exist”，能引导用户正确授权。
- 后续：
  - 待补齐 vc scopes 后再确认 meeting_id 是否可直接用于 info；如果仍不匹配，再考虑调整 list 输出/增加 alias。

### P1-2 contacts 模块入口不直观（不存在 contacts list）
- 现象：`lark contacts` 下只有 `contacts user ...` 子命令。
- 影响：用户很自然会尝试 `contacts list` 但失败；help 信息可更明确。
- 建议动作：
  - 在 `contacts` 根命令 help 中明确示例（例如 `lark contacts user search ...`）。
  - 可选：增加一个聚合的 `contacts user list/search` 的 alias 或更友好的 UX。

### P1-3 tasklists/info、drive permissions delete 等需要确认（--force）
- 现象：
  - `tasklists info` / `drive permissions delete` 在某些情况下要求确认，需 `--force`。
- 影响：脚本化体验需要额外处理。
- 结论：这是合理的安全机制；建议文档/示例里强调 `--force`。

### P1-4 mail folders 无 --limit（与 mail list 不一致）
- 现象：`lark mail folders` 不支持 `--limit`。
- 影响：与其它 list 风格不一致（虽不严重）。
- 建议动作：可选增加 `--limit` 或在输出上说明固定返回系统文件夹。

## P2（优化/一致性/提示文案）

### P2-1 users search 的 scope 提示已优化（已验证 OK）
- 现象：之前缺 `contact:user.employee_id:readonly`。
- 现在：已授权后 `lark users search "Fred" --limit 3` ✅ 正常返回。
- 提示：当前错误提示已改为建议 `lark auth user login --services "search-user" --force-consent`，更符合默认按 service 选择的交互预期。

### P2-2 calendars page_size 下限（已修复并验证）
- 背景：Calendar v4 events 要求 `page_size >= 50`，否则 99992402。
- 现在：已在代码里做 clamp（50..1000），并把错误带 code=%d；tenant/user list 均验证 OK。

---

## 已回归验证的链路（通过）
- docs: create / info / overwrite ✅
- drive: list / share / permissions list / permissions add+delete（--force）✅
- calendars: list（tenant/user）✅；create/get/delete ✅
- sheets: create + info ✅
- messages: send ✅
- mail: folders / list ✅
- meetings: list ✅
